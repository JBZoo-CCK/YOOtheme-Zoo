/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

(function($){var Plugin=function(){};$.extend(Plugin.prototype,{name:"Googlemaps",options:{lat:53.553407,lng:9.992196,marker:true,popup:false,text:"",zoom:13,mapCtrl:2,zoomWhl:true,mapType:0,typeCtrl:true,overviewCtrl:true,directions:true,directionsDestUpdate:false,directionsTravelMode:0,locale:"en",mainIcon:"red-dot",otherIcon:"blue-dot",iconUrl:"http://maps.google.com/mapfiles/ms/micons/",msgFromAddress:"From address: ",msgGetDirections:"Get directions",msgEmpty:"Please fill in your address.",msgNotFound:"Sorry, address not found!",msgAddressNotFound:", not found!"},initialize:function(container,options){this.options=$.extend({},this.options,options);this.container=container;this.setupMap();if(this.options.directions){this.setupDirections()}},setupMap:function(){this.map=new google.maps.Map(this.container.get(0),{mapTypeId:google.maps.MapTypeId.ROADMAP});this.map.setOptions({navigationControl:this.options.mapCtrl==1||this.options.mapCtrl==2?true:false});this.map.setOptions({navigationControlOptions:{style:this.options.mapCtrl==1?google.maps.NavigationControlStyle.SMALL:google.maps.NavigationControlStyle.DEFAULT}});this.map.setOptions({scrollwheel:this.options.zoomWhl?true:false});if(this.options.mapType==1)this.map.setOptions({mapTypeId:google.maps.MapTypeId.SATELLITE});if(this.options.mapType==2)this.map.setOptions({mapTypeId:google.maps.MapTypeId.HYBRID});if(this.options.mapType==3)this.map.setOptions({mapTypeId:google.maps.MapTypeId.TERRAIN});this.map.setOptions({mapTypeControl:this.options.typeCtrl?true:false});this.infowindow=new google.maps.InfoWindow;if(this.options.marker){this.addMarkerLatLng(this.options.lat,this.options.lng,this.options.text,true)}else{this.centerMap(this.options.lat,this.options.lng)}},createMarker:function(position,text,iconimage){var $this=this;var map=this.map;var infowindow=this.infowindow;var markerImage=new google.maps.MarkerImage(this.options.iconUrl+iconimage+".png",new google.maps.Size(32,32),new google.maps.Point(0,0),new google.maps.Point(16,32));var shadow=iconimage.match("pushpin")?this.options.iconUrl+"pushpin_shadow.png":this.options.iconUrl+"msmarker.shadow.png";var shadowImage=new google.maps.MarkerImage(shadow,new google.maps.Size(56,32),new google.maps.Point(0,0),new google.maps.Point(16,32));var marker=new google.maps.Marker({position:position,icon:markerImage,shadow:shadowImage,map:this.map});if(text||this.options.directionsDestUpdate){google.maps.event.addListener(marker,"click",function(){if(text){infowindow.setContent(text);infowindow.open(map,marker)}if($this.options.directionsDestUpdate){$this.options.lat=marker.getPosition().lat();$this.options.lng=marker.getPosition().lng()}})}return marker},centerMap:function(lat,lng){var point=new google.maps.LatLng(lat,lng);this.map.setCenter(point);this.map.setZoom(this.options.zoom)},addMarkerLatLng:function(lat,lng,text,center){var icon=this.options.otherIcon;if(center)icon=this.options.mainIcon;var point=new google.maps.LatLng(lat,lng);var marker=this.createMarker(point,text,icon);if(center){this.map.setCenter(point);this.map.setZoom(this.options.zoom)}if(center&&text&&this.options.popup){this.infowindow.setContent(text);this.infowindow.open(this.map,marker)}},setupDirections:function(){var $this=this;this.directionsService=new google.maps.DirectionsService;this.directionsDisplay=new google.maps.DirectionsRenderer;this.directionsDisplay.setMap(this.map);this.directionsDisplay.setPanel($("<div>").addClass("directions").css("position","relative").insertAfter(this.container).get(0));var p=$("<p>").append('<label for="from-address">'+this.options.msgFromAddress+"</label>").append('<input type="text" name="address" style="margin:0 5px;" />').append('<button type="submit">'+this.options.msgGetDirections+"</button>");$('<form method="get" action="#"></form>').append(p).insertAfter(this.container).bind("submit",function(event){event.preventDefault();event.stopPropagation();$this.setDirections($(this))})},setDirections:function(form){var $this=this;this.container.parent().find("div.alert").remove();var from=form.find('input[name="address"]').val();if(from===""){this.showAlert(this.options.msgEmpty)}else{var request={origin:from,destination:new google.maps.LatLng(this.options.lat,this.options.lng),travelMode:google.maps.DirectionsTravelMode.DRIVING,region:this.options.locale};this.directionsService.route(request,function(response,status){if(status==google.maps.DirectionsStatus.OK){$this.directionsDisplay.setDirections(response)}else{$this.showAlert($this.options.msgNotFound)}})}},showAlert:function(msg){$("<div>").addClass("alert").append($("<strong>").text(msg)).insertAfter(this.container)},refresh:function(){google.maps.event.trigger(this.map,"resize");this.centerMap(this.options.lat,this.options.lng)}});$.fn[Plugin.prototype.name]=function(){var args=arguments;var method=args[0]?args[0]:null;return this.each(function(){var element=$(this);if(Plugin.prototype[method]&&element.data(Plugin.prototype.name)&&method!="initialize"){element.data(Plugin.prototype.name)[method].apply(element.data(Plugin.prototype.name),Array.prototype.slice.call(args,1))}else if(!method||$.isPlainObject(method)){var plugin=new Plugin;if(Plugin.prototype["initialize"]){plugin.initialize.apply(plugin,$.merge([element],args))}element.data(Plugin.prototype.name,plugin)}else{$.error("Method "+method+" does not exist on jQuery."+Plugin.name)}})}})(jQuery);