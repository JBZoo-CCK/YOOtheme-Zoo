/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

(function($){var Plugin=function(){};$.extend(Plugin.prototype,{name:"ElementRepeatable",options:{msgDeleteElement:null,msgSortElement:null},initialize:function(element,options){this.options=$.extend({},this.options,options);var $this=this;var list=element.find("ul.repeatable-list");var hidden=list.find("li.hidden").remove();var count=list.find("li.repeatable-element").length;list.find("li.repeatable-element").each(function(){$this.attachButtons($(this))});list.delegate("span.sort","mousedown",function(){list.find(".more-options.show-advanced").removeClass("show-advanced")}).delegate("span.delete","click",function(){$(this).closest("li.repeatable-element").fadeOut(200,function(){$(this).remove()})}).sortable({handle:"span.sort",placeholder:"repeatable-element dragging",axis:"y",opacity:1,delay:100,cursorAt:{top:16},tolerance:"pointer",containment:"parent",scroll:false,start:function(event,ui){ui.item.addClass("ghost");ui.placeholder.height(ui.item.height()-2);ui.placeholder.width(ui.item.find("div.repeatable-content").width()-2)},stop:function(event,ui){ui.item.removeClass("ghost")}});element.find("p.add a").bind("click",function(){var li=$("<li>").addClass("repeatable-element").html(hidden.html().replace(/(elements\[\S+])\[(-?\d+)\]/g,"$1["+count++ +"]"));$this.attachButtons(li);li.appendTo(list);li.find('input:not([type="radio"]), :not([type="checkbox"])').each(function(){if($(this).val())$(this).val("")});li.children("div.repeatable-content").effect("highlight",{},1e3)})},attachButtons:function(element){element.children().wrapAll($("<div>").addClass("repeatable-content"));$("<span>").addClass("sort").attr("title",this.options.msgSortElement).appendTo(element);$("<span>").addClass("delete").attr("title",this.options.msgDeleteElement).appendTo(element)}});$.fn[Plugin.prototype.name]=function(){var args=arguments;var method=args[0]?args[0]:null;return this.each(function(){var element=$(this);if(Plugin.prototype[method]&&element.data(Plugin.prototype.name)&&method!="initialize"){element.data(Plugin.prototype.name)[method].apply(element.data(Plugin.prototype.name),Array.prototype.slice.call(args,1))}else if(!method||$.isPlainObject(method)){var plugin=new Plugin;if(Plugin.prototype["initialize"]){plugin.initialize.apply(plugin,$.merge([element],args))}element.data(Plugin.prototype.name,plugin)}else{$.error("Method "+method+" does not exist on jQuery."+Plugin.name)}})}})(jQuery);