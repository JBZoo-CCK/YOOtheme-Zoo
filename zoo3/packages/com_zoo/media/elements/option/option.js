/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

(function(a){var b=function(){};a.extend(b.prototype,{name:"ElementSelect",options:{element:null,variable:null,url:""},initialize:function(c,e){this.options=a.extend({},this.options,e);var d=this;this.element=c;this.list=c.children("ul");this.hidden=this.list.find("li.hidden").detach();c.delegate("div.delete","click",function(){a(this).parent("li").slideUp(400,function(){a(this).remove();d.orderOptions()})}).delegate("div.name-input input","blur",function(){var c=a(this).closest("li"),e=c.find("div.panel input:text");
if(""!=a(this).val()&&""==e.val()){var b="";d.getAlias(a(this).val(),function(a){b=a?a:"42";e.val(b);c.find("a.trigger").text(b)})}}).delegate("div.panel input:text","keydown",function(c){c.stopPropagation();13==c.which&&d.setOptionValue(a(this).closest("li"));27==c.which&&d.removeOptionPanel(a(this).closest("li"))}).delegate("input.accept","click",function(){d.setOptionValue(a(this).closest("li"))}).delegate("a.cancel","click",function(){d.removeOptionPanel(a(this).closest("li"))}).delegate("a.trigger",
"click",function(){a(this).hide().closest("li").find("div.panel").addClass("active").find("input:text").focus()}).find("div.add").bind("click",function(){d.hidden.clone().removeClass("hidden").appendTo(d.list).slideDown(200).effect("highlight",{},1E3).find("input:first").focus();d.orderOptions()});this.list.sortable({handle:"div.sort-handle",containment:this.list.parent().parent(),placeholder:"dragging",axis:"y",opacity:1,revert:75,delay:100,tolerance:"pointer",zIndex:99,start:function(c,a){a.placeholder.height(a.helper.height());
d.list.sortable("refreshPositions")},stop:function(){d.orderOptions()}})},setOptionValue:function(c){var a=this,d=c.find("div.panel input:text"),b=d.val();""==b&&(b=c.find("div.name-input input").val());this.getAlias(b,function(g){b=g?g:"42";d.val(b);c.find("a.trigger").text(b);a.removeOptionPanel(c)})},removeOptionPanel:function(a){a.find("div.panel input:text").val(a.find("a.trigger").show().text());a.find("div.panel").removeClass("active")},orderOptions:function(){var c=/^(\S+\[option\])\[\d+\](\[name\]|\[value\])$/;
this.list.children("li").each(function(b){a(this).find("input").each(function(){a(this).attr("name")&&a(this).attr("name",a(this).attr("name").replace(c,"$1["+b+"]$2"))})})},getAlias:function(c,b){a.getJSON(this.options.url,{name:c},function(a){b(a)})}});a.fn[b.prototype.name]=function(){var c=arguments,e=c[0]?c[0]:null;return this.each(function(){var d=a(this);if(b.prototype[e]&&d.data(b.prototype.name)&&"initialize"!=e)d.data(b.prototype.name)[e].apply(d.data(b.prototype.name),Array.prototype.slice.call(c,
1));else if(!e||a.isPlainObject(e)){var f=new b;b.prototype.initialize&&f.initialize.apply(f,a.merge([d],c));d.data(b.prototype.name,f)}else a.error("Method "+e+" does not exist on jQuery."+b.name)})}})(jQuery);
