/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

!function(e){var t=function(){};e.extend(t.prototype,{name:"finder",initialize:function(t,i){function n(i){i.preventDefault();var a=e(this).closest("li",t);a.length||(a=t),a.hasClass(o.options.open)?a.removeClass(o.options.open).children("ul").slideUp():(a.addClass(o.options.loading),e.post(o.options.url,{path:a.data("path")},function(t){a.removeClass(o.options.loading).addClass(o.options.open),t.length&&(a.children().remove("ul"),a.append("<ul>").children("ul").hide(),e.each(t,function(t,i){a.children("ul").append(e('<li><a href="#">'+i.name+"</a></li>").addClass(i.type).data("path",i.path))}),a.find("ul a").bind("click",n),a.children("ul").slideDown())},"json"))}var o=this;this.options=e.extend({url:"",path:"",open:"open",loading:"loading"},i),t.data("path",this.options.path).bind("retrieve:finder",n).trigger("retrieve:finder")}}),e.fn[t.prototype.name]=function(){var i=arguments,n=i[0]?i[0]:null;return this.each(function(){var o=e(this);if(t.prototype[n]&&o.data(t.prototype.name)&&"initialize"!=n)o.data(t.prototype.name)[n].apply(o.data(t.prototype.name),Array.prototype.slice.call(i,1));else if(!n||e.isPlainObject(n)){var a=new t;t.prototype.initialize&&a.initialize.apply(a,e.merge([o],i)),o.data(t.prototype.name,a)}else e.error("Method "+n+" does not exist on jQuery."+t.name)})}}(jQuery),function(e){var t=function(){};e.extend(t.prototype,{name:"Directories",initialize:function(t,i){this.options=e.extend({url:"",title:"Folders",mode:"folder",msgDelete:"Delete"},i);var n=this,o=e('<div class="finder" />').insertAfter(t).finder(this.options).delegate("a","click",function(i){o.find("li").removeClass("selected");var a=e(this).parent().addClass("selected");("file"!=n.options.mode||a.hasClass("file"))&&t.focus().val(a.data("path")).blur()}),a=o.dialog(e.extend({autoOpen:!1,resizable:!1,open:function(){a.position({of:l,my:"center top",at:"center bottom"})}},this.options)).dialog("widget"),l=e('<span title="'+this.options.title+'" class="'+this.options.mode+'s" />').insertAfter(t).bind("click",function(){o.dialog(o.dialog("isOpen")?"close":"open")});e('<span title="'+this.options.msgDelete+'" class="delete-file" />').insertAfter(l).bind("click",function(){t.val("")}),e("body").bind("click",function(e){!o.dialog("isOpen")||l.is(e.target)||a.find(e.target).length||o.dialog("close")})}}),e.fn[t.prototype.name]=function(){var i=arguments,n=i[0]?i[0]:null;return this.each(function(){var o=e(this);if(t.prototype[n]&&o.data(t.prototype.name)&&"initialize"!=n)o.data(t.prototype.name)[n].apply(o.data(t.prototype.name),Array.prototype.slice.call(i,1));else if(!n||e.isPlainObject(n)){var a=new t;t.prototype.initialize&&a.initialize.apply(a,e.merge([o],i)),o.data(t.prototype.name,a)}else e.error("Method "+n+" does not exist on jQuery."+t.name)})}}(jQuery);