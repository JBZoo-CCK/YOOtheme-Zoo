/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

(function($){var Plugin=function(){};$.extend(Plugin.prototype,{name:"Comment",options:{cookiePrefix:"zoo-comment_",cookieLifetime:15552e3,msgCancel:"Cancel"},initialize:function(comments,options){this.options=$.extend({},this.options,options);var $this=this;var respond=comments.find("#respond");var edit=comments.find("#edit");respond.find("a.facebook-connect").bind("click",function(){$this.setLoginCookie("facebook")});respond.find("a.facebook-logout").bind("click",function(){$this.setLoginCookie("")});respond.find("a.twitter-connect").bind("click",function(){$this.setLoginCookie("twitter")});respond.find("a.twitter-logout").bind("click",function(){$this.setLoginCookie("")});respond.find("input:text").placeholder();edit.find(".comment-cancelEdit").bind("click",function(event){event.preventDefault();edit.hide();edit.appendTo($("#comments"));edit.find("input[name=comment_id]").val(0);edit.find("textarea[name=content]").val("")});comments.find(".comment").each(function(){var comment=$(this);comment.find(".reply").bind("click",function(event){event.preventDefault();edit.hide();respond.find(".comment-cancelReply").remove();$("<a>"+$this.options.msgCancel+"</a>").addClass("comment-cancelReply").attr("href","#respond").bind("click",function(event){event.preventDefault();respond.find(".comment-cancelReply").remove();respond.appendTo($("#comments"));respond.find("input[name=parent_id]").val(0)}).appendTo(respond.find(".actions"));respond.appendTo(comment);respond.find("input[name=parent_id]").val($(this).closest(".comment").attr("id").replace(/comment-/i,""))});comment.find(".edit").bind("click",function(event){event.preventDefault();respond.find(".comment-cancelReply").remove();respond.appendTo($("#comments"));respond.find("input[name=parent_id]").val(0);edit.appendTo(comment);edit.find("input[name=comment_id]").val($(this).closest(".comment").attr("id").replace(/comment-/i,""));edit.find("textarea[name=content]").val($(this).closest(".comment").find(".content").html());edit.show()})})},setLoginCookie:function(login){$.cookie(this.options.cookiePrefix+"login",login,{expires:this.options.cookieLifetime/(60*60*24),path:"/"})}});$.fn[Plugin.prototype.name]=function(){var args=arguments;var method=args[0]?args[0]:null;return this.each(function(){var element=$(this);if(Plugin.prototype[method]&&element.data(Plugin.prototype.name)&&method!="initialize"){element.data(Plugin.prototype.name)[method].apply(element.data(Plugin.prototype.name),Array.prototype.slice.call(args,1))}else if(!method||$.isPlainObject(method)){var plugin=new Plugin;if(Plugin.prototype["initialize"]){plugin.initialize.apply(plugin,$.merge([element],args))}element.data(Plugin.prototype.name,plugin)}else{$.error("Method "+method+" does not exist on jQuery."+Plugin.name)}})}})(jQuery);(function($){var Plugin=function(){};$.extend(Plugin.prototype,{name:"BrowseComments",options:{url:"index.php?option=com_zoo&controller=comment",id:"edit-comment-editor"},initialize:function(form,options){this.options=$.extend({},this.options,options);var $this=this;this.form=form;form.delegate("tr.comment-row .actions-links .edit, tr.comment-row .actions-links .reply","click",function(event){event.preventDefault();var task=$(this).attr("class");$this.modifyEvent($(this).closest("tr.comment-row"),task)});form.delegate("tr.comment-row .actions-links span","click",function(event){event.preventDefault();switch($(this).attr("class")){case"no-spam":var task="approve";break;case"delete":var task="remove";break;default:var task=$(this).attr("class");break}$this.stateEvent($(this).closest("tr.comment-row"),task)})},modifyEvent:function(row,task){var $this=this;$.ajax({url:this.options.url,data:{task:task,format:"raw",cid:row.find('input[name^="cid["]').val()},success:function(data){$this.removeEditor();$this.insertEditor(row,data);if(task=="edit")row.hide();$this.form.unbind("save").unbind("cancel").bind("save",function(event,data){$this.removeEditor();if(task=="edit"){row.replaceWith(data)}else{$(data).insertAfter(row)}$this.stripe()}).bind("cancel",function(){$this.removeEditor()})}})},stateEvent:function(row,task){$('<input type="hidden" name="cid">').val(row.find('input[name^="cid["]').val()).appendTo(this.form);this.form.find("input[name=task]").val(task);this.form.submit()},insertEditor:function(row,data){var $this=this,editor=row.after(data).next();editor.find(".actions .save").bind("click",function(event){event.preventDefault();var post={};$.each($this.form.serializeArray(),function(i,field){post[field.name]=field.value});$.ajax({type:"POST",url:$this.options.url,data:$.extend(post,{task:"save",format:"raw"}),success:function(data){$this.form.triggerHandler("save",data)}})});editor.find(".actions .cancel").bind("click",function(event){event.preventDefault();$this.form.triggerHandler("cancel")});editor.find(".content textarea").focus()},removeEditor:function(){$("#"+this.options.id,this.form).prev("tr").show();$("#"+this.options.id,this.form).remove()},stripe:function(){$("table.stripe tbody tr").removeClass("odd even").each(function(){$(this).addClass($(this).is("tr:odd")?"odd":"even")})}});$.fn[Plugin.prototype.name]=function(){var args=arguments;var method=args[0]?args[0]:null;return this.each(function(){var element=$(this);if(Plugin.prototype[method]&&element.data(Plugin.prototype.name)&&method!="initialize"){element.data(Plugin.prototype.name)[method].apply(element.data(Plugin.prototype.name),Array.prototype.slice.call(args,1))}else if(!method||$.isPlainObject(method)){var plugin=new Plugin;if(Plugin.prototype["initialize"]){plugin.initialize.apply(plugin,$.merge([element],args))}element.data(Plugin.prototype.name,plugin)}else{$.error("Method "+method+" does not exist on jQuery."+Plugin.name)}})}})(jQuery);