/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

!function($){var plugin,tmp,loading,overlay,wrap,outer,content,close,title,nav_left,nav_right,body_margin,selectedIndex=0,selectedOpts={},selectedArray=[],currentIndex=0,currentOpts={},currentArray=[],ajaxLoader=null,imgPreloader=new Image,loadingTimer,loadingFrame=1,imgRegExp=/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i,swfRegExp=/[^\.]\.(swf)\s*$/i,youtubeRegExp=/(\/\/.*?youtube\.[a-z]+)\/watch\?v=([^&]+)&?(.*)/,youtubeRegExp2=/youtu\.be\/(.*)/,vimeoRegExp=/(\/\/.*?)vimeo\.[a-z]+\/([0-9]+).*?/,videoRegExp=/\.(mp4|ogv|webm|flv)(.*)?$/i,titleHeight=0,titleStr="",start_pos,final_pos,busy=!1,fx=$.extend($("<div/>")[0],{prop:0});_abort=function(){loading.hide(),imgPreloader.onerror=imgPreloader.onload=null,ajaxLoader&&ajaxLoader.abort(),tmp.empty()},_error=function(){return!1===selectedOpts.onError(selectedArray,selectedIndex,selectedOpts)?(loading.hide(),void(busy=!1)):(selectedOpts.titleShow=!1,selectedOpts.width="auto",selectedOpts.height="auto",tmp.html('<p id="lightbox-error">The requested content cannot be loaded.<br />Please try again later.</p>'),void _process_inline())},_start=function(){var obj=selectedArray[selectedIndex],href,type,title,str,emb,ret;if(_abort(),selectedOpts=$.extend({},plugin.defaults,"undefined"==typeof $(obj).data(plugin.name)?selectedOpts:$(obj).data(plugin.name)),$(obj).attr("data-lightbox")&&$.each($(obj).attr("data-lightbox").split(";"),function(i,option){var opt=option.match(/\s*([A-Z_]*?)\s*:\s*(.+)\s*/i);opt&&(selectedOpts[opt[1]]=opt[2],("true"===selectedOpts[opt[1]]||"false"===selectedOpts[opt[1]])&&(selectedOpts[opt[1]]=eval(opt[2])))}),ret=("string"==typeof selectedOpts.onStart?window[selectedOpts.onStart]:selectedOpts.onStart)(selectedArray,selectedIndex,selectedOpts),ret===!1)return void(busy=!1);if("object"==typeof ret&&(selectedOpts=$.extend(selectedOpts,ret)),title=selectedOpts.title||(obj.nodeName?$(obj).attr("title"):obj.title)||"",obj.nodeName&&!selectedOpts.orig&&(selectedOpts.orig=$(obj).children("img:first").length?$(obj).children("img:first"):$(obj)),""===title&&selectedOpts.orig&&selectedOpts.titleFromAlt&&(title=selectedOpts.orig.attr("alt")),href=selectedOpts.href||(obj.nodeName?$(obj).attr("href"):obj.href)||null,(/^(?:javascript)/i.test(href)||"#"==href)&&(href=null),selectedOpts.type)type=selectedOpts.type,href||(href=selectedOpts.content);else if(selectedOpts.content)type="html";else if(href)if(href.match(imgRegExp))type="image";else if(href.match(swfRegExp))type="swf";else if(href.match(videoRegExp))type="video";else if(href.match(youtubeRegExp))href=href.replace(youtubeRegExp,"$1/embed/$2?$3").replace("/(.*)?$/",""),type="iframe";else if(href.match(youtubeRegExp2)){var parts=href.split("/");href="//www.youtube.com/embed/"+parts[parts.length-1],type="iframe"}else href.match(vimeoRegExp)?(href=href.replace(vimeoRegExp,"$1player.vimeo.com/video/$2"),type="iframe"):type=-1!=href.indexOf("http://")&&-1==href.indexOf(location.hostname.toLowerCase())?"iframe":0===href.indexOf("#wk-")?window.wk_ajax_render_url?"widget":!1:0===href.indexOf("#")?"inline":"ajax";if(!type)return void _error();switch("inline"==type&&(obj=href.substr(href.indexOf("#")),type=$(obj).length>0?"inline":"ajax"),selectedOpts.type=type,selectedOpts.href=href,selectedOpts.title=title,selectedOpts.autoDimensions&&"iframe"!==selectedOpts.type&&"swf"!==selectedOpts.type&&"video"!==selectedOpts.type&&"widget"!==selectedOpts.type&&(selectedOpts.width="auto",selectedOpts.height="auto"),selectedOpts.modal&&(selectedOpts.overlayShow=!0,selectedOpts.hideOnOverlayClick=!1,selectedOpts.hideOnContentClick=!1,selectedOpts.enableEscapeButton=!1,selectedOpts.showCloseButton=!1),selectedOpts.padding=parseInt(selectedOpts.padding,10),selectedOpts.margin=parseInt(selectedOpts.margin,10),tmp.css("padding",selectedOpts.padding+selectedOpts.margin),$(".lightbox-inline-tmp").unbind("lightbox-cancel").bind("lightbox-change",function(){$(this).replaceWith(content.children())}),type){case"html":tmp.html(selectedOpts.content),_process_inline();break;case"video":busy=!1,selectedOpts.scrolling="no";var vwidth="auto"==selectedOpts.width?320:selectedOpts.width,vheight="auto"==selectedOpts.height?240:selectedOpts.height,vattrs=[];vattrs.push('src="'+href+'"'),vattrs.push('width="'+vwidth+'"'),vattrs.push('height="'+vheight+'"'),vattrs.push('preload="none"'),"undefined"!=$.type(selectedOpts.autoplay)&&vattrs.push('autoplay="'+String(selectedOpts.autoplay)+'"'),"undefined"!=$.type(selectedOpts.controls)&&vattrs.push('controls="'+String(selectedOpts.controls)+'"'),"undefined"!=$.type(selectedOpts.loop)&&vattrs.push('loop="'+String(selectedOpts.loop)+'"'),"undefined"!=$.type(selectedOpts.poster)&&vattrs.push('poster="'+String(selectedOpts.poster)+'"'),tmp.html("<video "+vattrs.join(" ")+" /></video>"),$.fn.mediaelementplayer&&$("video",tmp).each(function(){var e=new mejs.MediaElementPlayer(this);vwidth>$(window).width()&&e.setPlayerSize("100%","100%")}),selectedOpts.width="auto",selectedOpts.height="auto",_process_inline();break;case"inline":if($(obj).parent().is("#lightbox-content")===!0)return void(busy=!1);$('<div class="lightbox-inline-tmp" />').hide().insertBefore($(obj)).bind("lightbox-cleanup",function(){$(this).replaceWith(content.children())}).bind("lightbox-cancel",function(){$(this).replaceWith(tmp.children())}),$(obj).appendTo(tmp),_process_inline();break;case"image":busy=!1,plugin.showActivity(),imgPreloader=new Image,imgPreloader.onerror=function(){_error()},imgPreloader.onload=function(){busy=!0,imgPreloader.onerror=imgPreloader.onload=null,_process_image()},imgPreloader.src=href;break;case"swf":selectedOpts.scrolling="no",selectedOpts.autoDimensions=!1,str='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+selectedOpts.width+'" height="'+selectedOpts.height+'"><param name="movie" value="'+href+'"></param>',emb="",$.each(selectedOpts.swf,function(e,t){str+='<param name="'+e+'" value="'+t+'"></param>',emb+=" "+e+'="'+t+'"'}),str+='<embed src="'+href+'" type="application/x-shockwave-flash" width="'+selectedOpts.width+'" height="'+selectedOpts.height+'"'+emb+"></embed></object>",tmp.html(str),_process_inline();break;case"ajax":busy=!1,plugin.showActivity(),selectedOpts.ajax.win=selectedOpts.ajax.success,ajaxLoader=$.ajax($.extend({},selectedOpts.ajax,{url:href,data:selectedOpts.ajax.data||{},error:function(e,t,r){e.status>0&&_error()},success:function(e,t,r){var i="object"==typeof r?r:ajaxLoader;if(200==i.status){if("function"==typeof selectedOpts.ajax.win){if(ret=selectedOpts.ajax.win(href,e,t,r),ret===!1)return void loading.hide();("string"==typeof ret||"object"==typeof ret)&&(e=ret)}tmp.html(e),_process_inline()}}}));break;case"widget":busy=!1,selectedOpts.autoDimensions=!1,plugin.showActivity(),selectedOpts.ajax.win=selectedOpts.ajax.success,ajaxLoader=$.ajax($.extend({},selectedOpts.ajax,{url:wk_ajax_render_url(href.split("-")[1]),data:selectedOpts.ajax.data||{},error:function(e,t,r){e.status>0&&_error()},success:function(e,t,r){var i="object"==typeof r?r:ajaxLoader;if(200==i.status){if("function"==typeof selectedOpts.ajax.win){if(ret=selectedOpts.ajax.win(href,e,t,r),ret===!1)return void loading.hide();("string"==typeof ret||"object"==typeof ret)&&(e=ret)}tmp.html(e),_process_inline(),$widgetkit.lazyload($("#lightbox-content"))}}}));break;case"iframe":selectedOpts.autoDimensions=!1,_show()}},_process_inline=function(){tmp.wrapInner('<div style="width:'+("auto"==selectedOpts.width?"auto":selectedOpts.width+"px")+";height:"+("auto"==selectedOpts.height?"auto":selectedOpts.height+"px")+";overflow: "+("auto"==selectedOpts.scrolling?"auto":"yes"==selectedOpts.scrolling?"scroll":"hidden")+'"></div>'),selectedOpts.width=tmp.width(),selectedOpts.height=tmp.height(),_show()},_process_image=function(){selectedOpts.width=imgPreloader.width,selectedOpts.height=imgPreloader.height,$("<img />").attr({id:"lightbox-img",src:imgPreloader.src,alt:selectedOpts.title}).appendTo(tmp),_show()},_show=function(){var e,t;return loading.hide(),wrap.is(":visible")&&!1===currentOpts.onCleanup(currentArray,currentIndex,currentOpts)?($(".lightbox-inline-tmp").trigger("lightbox-cancel"),void(busy=!1)):(busy=!0,$(content.add(overlay)).unbind(),$(window).unbind("resize.fb scroll.fb"),$(document).unbind("keydown.fb"),wrap.is(":visible")&&"outside"!==currentOpts.titlePosition&&wrap.css("height",wrap.height()),currentArray=selectedArray,currentIndex=selectedIndex,currentOpts=selectedOpts,currentOpts.overlayShow?(overlay.css({"background-color":currentOpts.overlayColor,opacity:currentOpts.overlayOpacity,cursor:currentOpts.hideOnOverlayClick?"pointer":"auto",height:$(document).height()}),overlay.is(":visible")||overlay.show()):overlay.hide(),final_pos=_get_zoom_to(),_process_title(),wrap.is(":visible")?($(close.add(nav_left).add(nav_right)).hide(),e=wrap.position(),start_pos={top:e.top,left:e.left,width:wrap.width(),height:wrap.height()},t=start_pos.width==final_pos.width&&start_pos.height==final_pos.height,void content.fadeTo(currentOpts.changeFade,.3,function(){var e=function(){content.html(tmp.contents()).fadeTo(currentOpts.changeFade,1,_finish)};$(".lightbox-inline-tmp").trigger("lightbox-change"),content.empty().removeAttr("filter").css({"border-width":currentOpts.padding,width:final_pos.width-2*currentOpts.padding,height:"image"==currentOpts.type||"swf"==currentOpts.type||"iframe"==currentOpts.type?final_pos.height-titleHeight-2*currentOpts.padding:"auto"}),t?e():(fx.prop=0,$(fx).animate({prop:1},{duration:currentOpts.changeSpeed,easing:currentOpts.easingChange,step:_draw,complete:e}))})):(wrap.removeAttr("style"),content.css("border-width",currentOpts.padding),content.css("-webkit-transform","translateZ(0)"),"elastic"==currentOpts.transitionIn?(start_pos=_get_zoom_from(),content.html(tmp.contents()),wrap.show(),currentOpts.opacity&&(final_pos.opacity=0),fx.prop=0,void $(fx).animate({prop:1},{duration:currentOpts.speedIn,easing:currentOpts.easingIn,step:_draw,complete:_finish})):("inside"==currentOpts.titlePosition&&titleHeight>0&&title.show(),content.css({width:final_pos.width-2*currentOpts.padding,height:"image"==currentOpts.type||"swf"==currentOpts.type||"iframe"==currentOpts.type?final_pos.height-titleHeight-2*currentOpts.padding:"auto"}).html(tmp.contents()),void wrap.css(final_pos).fadeIn("none"==currentOpts.transitionIn?0:currentOpts.speedIn,_finish))))},_format_title=function(e){return e&&e.length?'<div id="lightbox-title-'+currentOpts.titlePosition+'">'+e+"</div>":!1},_process_title=function(){if(titleStr=currentOpts.title||"",titleHeight=0,title.empty().removeAttr("style").removeClass(),currentOpts.titleShow===!1)return void title.hide();if(titleStr=$.isFunction(currentOpts.titleFormat)?currentOpts.titleFormat(titleStr,currentArray,currentIndex,currentOpts):_format_title(titleStr),!titleStr||""===titleStr)return void title.hide();switch(title.addClass("lightbox-title-"+currentOpts.titlePosition).html(titleStr).appendTo("body").show(),currentOpts.titlePosition){case"inside":title.css({width:final_pos.width-2*currentOpts.padding,marginLeft:currentOpts.padding,marginRight:currentOpts.padding}),titleHeight=title.outerHeight(!0),title.appendTo(outer),final_pos.height+=titleHeight;break;case"over":title.css({marginLeft:currentOpts.padding,width:final_pos.width-2*currentOpts.padding,bottom:currentOpts.padding}).appendTo(outer);break;case"float":title.css("left",-1*parseInt((title.width()-final_pos.width-40)/2,10)).appendTo(wrap);break;default:title.css({width:final_pos.width-2*currentOpts.padding,paddingLeft:currentOpts.padding,paddingRight:currentOpts.padding}).appendTo(wrap)}title.hide()},_set_navigation=function(){return(currentOpts.enableEscapeButton||currentOpts.enableKeyboardNav)&&$(document).bind("keydown.fb",function(e){27==e.keyCode&&currentOpts.enableEscapeButton?(e.preventDefault(),plugin.close()):37!=e.keyCode&&39!=e.keyCode||!currentOpts.enableKeyboardNav||"INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName||"SELECT"===e.target.tagName||(e.preventDefault(),plugin[37==e.keyCode?"prev":"next"]())}),currentOpts.showNavArrows?((currentOpts.cyclic&&currentArray.length>1||0!==currentIndex)&&nav_left.show(),void((currentOpts.cyclic&&currentArray.length>1||currentIndex!=currentArray.length-1)&&nav_right.show())):(nav_left.hide(),void nav_right.hide())},_finish=function(){$.support.opacity||(content.get(0).style.removeAttribute("filter"),wrap.get(0).style.removeAttribute("filter")),wrap.css("height","auto"),"image"!==currentOpts.type&&"swf"!==currentOpts.type&&"iframe"!==currentOpts.type&&content.css("height","auto"),titleStr&&titleStr.length&&title.show(),currentOpts.showCloseButton&&close.show(),_set_navigation(),currentOpts.hideOnContentClick&&content.bind("click",plugin.close),currentOpts.hideOnOverlayClick&&overlay.bind("click",plugin.close),$(window).bind("resize.fb",plugin.resize),currentOpts.centerOnScroll&&$(window).bind("scroll.fb",plugin.center),"iframe"==currentOpts.type&&$('<iframe id="lightbox-frame" name="lightbox-frame'+(new Date).getTime()+'" frameborder="0" hspace="0" '+($.support.opacity?"":'allowtransparency="true""')+' scrolling="'+selectedOpts.scrolling+'" src="'+currentOpts.href+'"></iframe>').appendTo(content),wrap.show(),busy=!1,plugin.center(),("string"==typeof currentOpts.onComplete?window[currentOpts.onComplete]:currentOpts.onComplete)(currentArray,currentIndex,currentOpts),_preload_images()},_preload_images=function(){var e,t;currentArray.length-1>currentIndex&&(e=currentArray[currentIndex+1].href,"undefined"!=typeof e&&e.match(imgRegExp)&&(t=new Image,t.src=e)),currentIndex>0&&(e=currentArray[currentIndex-1].href,"undefined"!=typeof e&&e.match(imgRegExp)&&(t=new Image,t.src=e))},_draw=function(e){var t={width:parseInt(start_pos.width+(final_pos.width-start_pos.width)*e,10),height:parseInt(start_pos.height+(final_pos.height-start_pos.height)*e,10),top:parseInt(start_pos.top+(final_pos.top-start_pos.top)*e,10),left:parseInt(start_pos.left+(final_pos.left-start_pos.left)*e,10)};"undefined"!=typeof final_pos.opacity&&(t.opacity=.5>e?.5:e),wrap.css(t),content.css({width:t.width-2*currentOpts.padding,height:t.height-titleHeight*e-2*currentOpts.padding})},_get_viewport=function(){return[$(window).width()-2*currentOpts.margin,$(window).height()-2*currentOpts.margin,$(document).scrollLeft()+currentOpts.margin,$(document).scrollTop()+currentOpts.margin]},_get_zoom_to=function(){var e,t=_get_viewport(),r={},i=currentOpts.autoScale,n=2*currentOpts.padding;return r.width=currentOpts.width.toString().indexOf("%")>-1?parseInt(t[0]*parseFloat(currentOpts.width)/100,10):parseInt(currentOpts.width)+n,r.height=currentOpts.height.toString().indexOf("%")>-1?parseInt(t[1]*parseFloat(currentOpts.height)/100,10):parseInt(currentOpts.height)+n,i&&(r.width>t[0]||r.height>t[1])&&("image"==selectedOpts.type||"swf"==selectedOpts.type?(e=currentOpts.width/currentOpts.height,r.width>t[0]&&(r.width=t[0],r.height=parseInt((r.width-n)/e+n,10)),r.height>t[1]&&(r.height=t[1],r.width=parseInt((r.height-n)*e+n,10))):(r.width=Math.min(r.width,t[0]),r.height=Math.min(r.height,t[1]))),r.top=parseInt(Math.max(t[3]-20,t[3]+.5*(t[1]-r.height-40)),10),r.left=parseInt(Math.max(t[2]-20,t[2]+.5*(t[0]-r.width-40)),10),r},_get_obj_pos=function(e){var t=e.offset();return t.top+=parseInt(e.css("paddingTop"),10)||0,t.left+=parseInt(e.css("paddingLeft"),10)||0,t.top+=parseInt(e.css("border-top-width"),10)||0,t.left+=parseInt(e.css("border-left-width"),10)||0,t.width=e.width(),t.height=e.height(),t},_get_zoom_from=function(){var e,t,r=selectedOpts.orig?$(selectedOpts.orig):!1,i={};return r&&r.length?(e=_get_obj_pos(r),i={width:e.width+2*currentOpts.padding,height:e.height+2*currentOpts.padding,top:e.top-currentOpts.padding-20,left:e.left-currentOpts.padding-20}):(t=_get_viewport(),i={width:2*currentOpts.padding,height:2*currentOpts.padding,top:parseInt(t[3]+.5*t[1],10),left:parseInt(t[2]+.5*t[0],10)}),i},_animate_loading=function(){return loading.is(":visible")?($("div",loading).css("top",-40*loadingFrame+"px"),void(loadingFrame=(loadingFrame+1)%12)):void clearInterval(loadingTimer)};var Plugin=function(){};Plugin.prototype=$.extend(Plugin.prototype,{name:"lightbox",defaults:{padding:10,margin:40,opacity:!1,modal:!1,cyclic:!1,scrolling:"auto",width:560,height:340,autoScale:!0,autoDimensions:!0,centerOnScroll:!1,ajax:{},swf:{wmode:"transparent"},hideOnOverlayClick:!0,hideOnContentClick:!1,overlayShow:!0,overlayOpacity:.7,overlayColor:"#777",titleShow:!0,titlePosition:"float",titleFormat:null,titleFromAlt:!1,transitionIn:"fade",transitionOut:"fade",speedIn:300,speedOut:300,changeSpeed:300,changeFade:"fast",easingIn:"swing",easingOut:"swing",showCloseButton:!0,showNavArrows:!0,enableEscapeButton:!0,enableKeyboardNav:!0,onStart:function(){},onCancel:function(){},onComplete:function(){},onCleanup:function(){},onClosed:function(){},onError:function(){}},init:function(){var e=this;$("#lightbox-wrap").length||($("body").append(tmp=$('<div id="lightbox-tmp"></div>'),loading=$('<div id="lightbox-loading"><div></div></div>'),overlay=$('<div id="lightbox-overlay"></div>'),wrap=$('<div id="lightbox-wrap"></div>')),body_margin=overlay.show().position(),overlay.hide(),0!=body_margin.top&&overlay.css("top",-1*body_margin.top),outer=$('<div id="lightbox-outer"></div>').appendTo(wrap),outer.append(content=$('<div id="lightbox-content"></div>'),close=$('<a id="lightbox-close"></a>'),title=$('<div id="lightbox-title"></div>'),nav_left=$('<a href="javascript:;" id="lightbox-left"><span id="lightbox-left-ico"></span></a>'),nav_right=$('<a href="javascript:;" id="lightbox-right"><span id="lightbox-right-ico"></span></a>')),close.bind("click",this.close),loading.bind("click",this.cancel),nav_left.bind("click",function(t){t.preventDefault(),e.prev()}),nav_right.bind("click",function(t){t.preventDefault(),e.next()}),$.fn.mousewheel&&wrap.bind("mousewheel.fb",function(t,r){(busy||"image"==currentOpts.type)&&t.preventDefault(),e[r>0?"prev":"next"]()}),"ontouchend"in document&&(wrap.bind("touchstart",function(e){function t(e){if(n){var t=e.originalEvent.touches?e.originalEvent.touches[0]:e;r={time:(new Date).getTime(),coords:[t.pageX,t.pageY]},Math.abs(n.coords[0]-r.coords[0])>10&&e.preventDefault()}}var r,i=e.originalEvent.touches?e.originalEvent.touches[0]:e,n={time:(new Date).getTime(),coords:[i.pageX,i.pageY],origin:$(e.target)};wrap.bind("touchmove",t).one("touchend",function(e){wrap.unbind("touchmove",t),n&&r&&r.time-n.time<1e3&&Math.abs(n.coords[0]-r.coords[0])>30&&Math.abs(n.coords[1]-r.coords[1])<75&&n.origin.trigger("swipe").trigger(n.coords[0]>r.coords[0]?"swipeleft":"swiperight"),n=r=void 0})}),wrap.bind("swipeleft",function(t){(busy||"image"==currentOpts.type)&&t.preventDefault(),e.next()}).bind("swiperight",function(t){(busy||"image"==currentOpts.type)&&t.preventDefault(),e.prev()})))},open:function(e){var t;if(!busy){if(busy=!0,t="undefined"!=typeof arguments[1]?arguments[1]:{},selectedArray=[],selectedIndex=parseInt(t.index,10)||0,$.isArray(e)){for(var r=0,i=e.length;i>r;r++)"object"==typeof e[r]?$(e[r]).data(plugin.name,$.extend({},t,e[r])):e[r]=$({}).data(plugin.name,$.extend({content:e[r]},t));selectedArray=$.merge(selectedArray,e)}else"object"==typeof e?$(e).data(plugin.name,$.extend({},t,e)):e=$({}).data(plugin.name,$.extend({content:e},t)),selectedArray.push(e);(selectedIndex>selectedArray.length||0>selectedIndex)&&(selectedIndex=0),_start()}},showActivity:function(){clearInterval(loadingTimer),loading.show(),loadingTimer=setInterval(_animate_loading,66)},hideActivity:function(){loading.hide()},next:function(){return this.pos(currentIndex+1)},prev:function(){return this.pos(currentIndex-1)},pos:function(e){busy||(e=parseInt(e),selectedArray=currentArray,e>-1&&e<currentArray.length?(selectedIndex=e,_start()):currentOpts.cyclic&&currentArray.length>1&&(selectedIndex=e>=currentArray.length?0:currentArray.length-1,_start()))},cancel:function(){busy||(busy=!0,$(".lightbox-inline-tmp").trigger("lightbox-cancel"),_abort(),selectedOpts.onCancel(selectedArray,selectedIndex,selectedOpts),busy=!1)},close:function(){function e(){overlay.fadeOut("fast"),title.empty().hide(),wrap.hide(),$(".lightbox-inline-tmp").trigger("lightbox-cleanup"),content.empty(),currentOpts.onClosed(currentArray,currentIndex,currentOpts),currentArray=selectedOpts=[],currentIndex=selectedIndex=0,currentOpts=selectedOpts={},busy=!1}if(!busy&&!wrap.is(":hidden")){if(busy=!0,currentOpts&&!1===currentOpts.onCleanup(currentArray,currentIndex,currentOpts))return void(busy=!1);if(_abort(),$(close.add(nav_left).add(nav_right)).hide(),$(content.add(overlay)).unbind(),$(window).unbind("resize.fb scroll.fb"),$(document).unbind("keydown.fb"),content.find("iframe").attr("src","about:blank"),"inside"!==currentOpts.titlePosition&&title.empty(),wrap.stop(),"elastic"==currentOpts.transitionOut){start_pos=_get_zoom_from();var t=wrap.position();final_pos={top:t.top,left:t.left,width:wrap.width(),height:wrap.height()},currentOpts.opacity&&(final_pos.opacity=1),title.empty().hide(),fx.prop=1,$(fx).animate({prop:0},{duration:currentOpts.speedOut,easing:currentOpts.easingOut,step:_draw,complete:e})}else wrap.fadeOut("none"==currentOpts.transitionOut?0:currentOpts.speedOut,e)}},resize:function(){switch(overlay.is(":visible")&&overlay.css("height",$(document).height()),final_pos=_get_zoom_to(),currentOpts.titlePosition){case"float":title.css("left",-1*parseInt((title.width()-final_pos.width-40)/2,10));break;default:title.css("width",final_pos.width-2*currentOpts.padding)}plugin.center(!0)},center:function(){var e,t;busy||(t=arguments[0]===!0?1:0,e=_get_viewport(),(t||!(wrap.width()>e[0]||wrap.height()>e[1]))&&wrap.stop().animate({top:parseInt(Math.max(e[3]-20,e[3]+.5*(e[1]-content.height()-40)-currentOpts.padding)),left:parseInt(Math.max(e[2]-20,e[2]+.5*(e[0]-content.width()-40)-currentOpts.padding))},"number"==typeof arguments[0]?arguments[0]:200))}}),$.fn[Plugin.prototype.name]=function(){var e=arguments,t=e[0]?e[0]:{};return this.each(function(){$(this).data(Plugin.prototype.name,t).unbind("click."+Plugin.prototype.name).bind("click."+Plugin.prototype.name,function(e){if(e.preventDefault(),!busy){busy=!0,$(this).blur(),selectedArray=[],selectedIndex=0;var t=$(this).attr("data-lightbox")||"";t&&(t=t.match(/group:([^;]+)/i))?(selectedArray=$('a[data-lightbox*="'+t[0]+'"], area[data-lightbox*="'+t[0]+'"]'),selectedIndex=selectedArray.index(this)):selectedArray.push(this),_start()}})})},$(document).ready(function(){plugin=new Plugin,plugin.init(),$[Plugin.prototype.name]=plugin})}(jQuery);