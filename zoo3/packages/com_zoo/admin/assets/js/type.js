/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

(function($){var Plugin=function(){};$.extend(Plugin.prototype,{name:"EditElements",options:{url:"index.php?option=com_zoo&controller=manager",msgNoElements:"No elements defined for this type",msgDeletelog:"Are you sure you want to delete the element?"},initialize:function(list,options){this.options=$.extend({},this.options,options);var $this=this;this.list=list;this.count=0;this.noElements();this.list.delegate("div.edit-event","click",function(){$(this).parent("li.element").toggleClass("hideconfig")}).delegate("div.delete-event","click",function(){if(confirm($this.options.msgDeletelog)){$(this).parent("li.element").fadeOut(200,function(){$(this).remove();$this.noElements()})}}).sortable({handle:"div.sort-event",placeholder:"element dragging",axis:"y",delay:100,tolerance:"pointer",scroll:false,start:function(event,ui){$this.list.children("li.element").each(function(){$(this).data("showconfig",!$(this).hasClass("hideconfig"));$(this).addClass("hideconfig")});var height=$("div.name",ui.item).height();ui.helper.height(height);ui.placeholder.height(height);$(this).sortable("refreshPositions")},stop:function(event,ui){$this.list.children("li.element").each(function(){if($(this).data("showconfig"))$(this).removeClass("hideconfig")})}});$("#add-element ul.elements li").bind("click",function(){var li=$("<li>").addClass("element loading").prependTo($this.list);$.ajax({url:$this.options.url,data:{format:"raw",task:"addelement",element:$(this).attr("class"),count:$this.count++},dataType:"html",success:function(data){li.removeClass("loading").html(data);new Tips(li.find(".hasTip").get(),{maxTitleChars:50,fixed:false});$this.noElements();$this.list.trigger("element.added",li);li.slideDown(200).effect("highlight",{},1e3)}})});$(".core-element-configuration > ul").hide();$(".core-element-configuration > .toggler").bind("click",function(e){e.preventDefault();$(".core-element-configuration > ul").toggle()});$(".core-element-configuration").delegate("div.edit-event","click",function(){$(this).parent("li.element").toggleClass("hideconfig")})},noElements:function(){this.list.find("li.no-elements").remove();if(this.list.children("li.element").length==0){$("<li>").addClass("no-elements").text(this.options.msgNoElements).appendTo(this.list)}}});$.fn[Plugin.prototype.name]=function(){var args=arguments;var method=args[0]?args[0]:null;return this.each(function(){var element=$(this);if(Plugin.prototype[method]&&element.data(Plugin.prototype.name)&&method!="initialize"){element.data(Plugin.prototype.name)[method].apply(element.data(Plugin.prototype.name),Array.prototype.slice.call(args,1))}else if(!method||$.isPlainObject(method)){var plugin=new Plugin;if(Plugin.prototype["initialize"]){plugin.initialize.apply(plugin,$.merge([element],args))}element.data(Plugin.prototype.name,plugin)}else{$.error("Method "+method+" does not exist on jQuery."+Plugin.name)}})}})(jQuery);(function($){var Plugin=function(){};$.extend(Plugin.prototype,{name:"AssignElements",initialize:function(form){var $this=this;$("ul.element-list").delegate("div.sort-event","mousedown",function(){$("li.element").not(".hideconfig").addClass("hideconfig")});$("ul.element-list:not(.unassigned)").sortable({handle:"div.sort-event",connectWith:"ul.element-list:not(.unassigned)",placeholder:"element hideconfig dragging",forcePlaceholderSize:true,cursorAt:{top:16},tolerance:"pointer",scroll:false,change:function(event,ui){$this.emptyList()},update:function(event,ui){if(ui.item.hasClass("assigning")){form.find("li.assigning").each(function(){if($(this).data("config")){var clone=$(this).data("config").clone();clone.find("input:radio").each(function(){$(this).attr("name",$(this).attr("name").replace(/^elements\[[\w_-]+\]/,"elements[_temp]"))});ui.item.append(clone)}});ui.item.removeClass("assigning")}$this.emptyList()},start:function(event,ui){ui.helper.addClass("ghost")},stop:function(event,ui){ui.item.removeClass("ghost");$this.emptyList().sanatizeList()}});$("ul.element-list.unassigned li.element").draggable({handle:"div.sort-event",scroll:false,zIndex:1e3,helper:function(){var clone=$(this).clone();clone.find("div.config").remove();return clone},connectToSortable:"ul.element-list:not(.unassigned)",drag:function(event,ui){$this.emptyList()},start:function(event,ui){$(this).addClass("assigning");$(this).data("config",$(this).find("div.config").remove());ui.helper.addClass("ghost")},stop:function(event,ui){$(this).removeClass("assigning");ui.helper.removeClass("ghost");$(this).append($(this).data("config"));$this.emptyList().sanatizeList()}});this.emptyList().sanatizeList();form.delegate("div.edit-event","click",function(){$(this).closest("li").toggleClass("hideconfig")}).delegate("div.delete-event","click",function(){$(this).closest("li").fadeOut(200,function(){$(this).remove();$this.emptyList().sanatizeList()})})},emptyList:function(){$("ul.element-list:not(.unassigned)").each(function(){var empty=$(this).hasClass("empty-list");var length=$(this).children(":not(.ui-sortable-helper)").length;if(empty&&length||!empty&&!length){$(this).toggleClass("empty-list")}});return this},sanatizeList:function(){var regexp=new RegExp(/(elements\[[a-z0-9_-]+\])|(positions\[[a-z0-9_-]+\]\[[0-9]+\])/);$("ul.element-list:not(.unassigned)").each(function(){var position="positions["+$(this).data("position")+"]";$(this).children().each(function(i){$(this).find("[name^=positions], [name^=elements]").each(function(){$(this).attr("name","tmp"+$(this).attr("name").replace(regexp,position+"["+i+"]"))})})});regexp=new RegExp(/^tmp/);$("ul.element-list").find("[name^=tmp]").each(function(){$(this).attr("name",$(this).attr("name").replace(regexp,""))});return this}});$.fn[Plugin.prototype.name]=function(){var args=arguments;var method=args[0]?args[0]:null;return this.each(function(){var element=$(this);if(Plugin.prototype[method]&&element.data(Plugin.prototype.name)&&method!="initialize"){element.data(Plugin.prototype.name)[method].apply(element.data(Plugin.prototype.name),Array.prototype.slice.call(args,1))}else if(!method||$.isPlainObject(method)){var plugin=new Plugin;if(Plugin.prototype["initialize"]){plugin.initialize.apply(plugin,$.merge([element],args))}element.data(Plugin.prototype.name,plugin)}else{$.error("Method "+method+" does not exist on jQuery."+Plugin.name)}})}})(jQuery);(function($){var Plugin=function(){};$.extend(Plugin.prototype,{name:"AssignSubmission",initialize:function(form){var $this=this;$("ul.element-list").delegate("div.sort-event","mousedown",function(){$("li.element").not(".hideconfig").addClass("hideconfig")}).sortable({handle:"div.sort-event",connectWith:'ul.element-list:not([data-position="unassigned"])',placeholder:"element hideconfig dragging",forcePlaceholderSize:true,cursorAt:{top:16},tolerance:"pointer",scroll:false,start:function(event,ui){ui.helper.addClass("ghost")},stop:function(event,ui){ui.item.removeClass("ghost")},change:function(event,ui){$this.emptyList()},update:function(event,ui){$this.emptyList()}});this.emptyList();form.delegate("div.edit-event","click",function(){$(this).closest("li").toggleClass("hideconfig")}).delegate("div.delete-event","click",function(){$(this).closest("li").appendTo($("ul.element-list[data-position=unassigned]")).addClass("hideconfig").effect("highlight",{},1e3);$this.emptyList()});$.each(["apply","save","save-new"],function(i,task){$("#toolbar-"+task+" a, #toolbar-"+task+" button").bind("validate.adminForm",function(event){$('ul.element-list:not([data-position="unassigned"])').each(function(){var position=$(this).data("position");$(this).children().each(function(i){var identifier=$(this).data("element");$(this).find('[name^="'+identifier+'"]').each(function(){$(this).attr("name","positions["+position+"]["+i+"]"+$(this).attr("name").replace(new RegExp(identifier),""))})})})})})},emptyList:function(){$("ul.element-list").each(function(){$(this).removeClass("empty-list");if($(this).children(":not(.ui-sortable-helper)").length==0){$(this).addClass("empty-list")}});return this}});$.fn[Plugin.prototype.name]=function(){var args=arguments;var method=args[0]?args[0]:null;return this.each(function(){var element=$(this);if(Plugin.prototype[method]&&element.data(Plugin.prototype.name)&&method!="initialize"){element.data(Plugin.prototype.name)[method].apply(element.data(Plugin.prototype.name),Array.prototype.slice.call(args,1))}else if(!method||$.isPlainObject(method)){var plugin=new Plugin;if(Plugin.prototype["initialize"]){plugin.initialize.apply(plugin,$.merge([element],args))}element.data(Plugin.prototype.name,plugin)}else{$.error("Method "+method+" does not exist on jQuery."+Plugin.name)}})}})(jQuery);(function($){var Plugin=function(){};$.extend(Plugin.prototype,{name:"EditType",initialize:function(input){$.each(["apply","save"],function(i,task){$("#toolbar-"+task+" a").removeAttr("onclick").bind("click",function(event){if(input.find('input[name="name"]').val()==""){input.find("span.message-name").css("display","block")}else{submitbutton(task+"type")}})})}});$.fn[Plugin.prototype.name]=function(){var args=arguments;var method=args[0]?args[0]:null;return this.each(function(){var element=$(this);if(Plugin.prototype[method]&&element.data(Plugin.prototype.name)&&method!="initialize"){element.data(Plugin.prototype.name)[method].apply(element.data(Plugin.prototype.name),Array.prototype.slice.call(args,1))}else if(!method||$.isPlainObject(method)){var plugin=new Plugin;if(Plugin.prototype["initialize"]){plugin.initialize.apply(plugin,$.merge([element],args))}element.data(Plugin.prototype.name,plugin)}else{$.error("Method "+method+" does not exist on jQuery."+Plugin.name)}})}})(jQuery);