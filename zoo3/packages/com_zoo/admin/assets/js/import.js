/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

(function($){var Plugin=function(){};Plugin.prototype=$.extend(Plugin.prototype,{name:"ImportExport",options:{msgImportWarning:"Please choose a file first!"},initialize:function(form,options){this.options=$.extend({},this.options,options);var $this=this;form.find("div.uploadbox").each(function(){var filename=$(this).find("input.filename");$(this).find('input[name^="import-"]').bind("change",function(){filename.val(this.value)});$(this).find("button.upload").bind("click",function(){if(filename.val()==""){alert($this.options.msgImportWarning)}else{submitbutton("import")}})});form.find("a.exporter-link").each(function(){var exporter=$(this);exporter.bind("click",function(){form.find('input[name="exporter"]').val(exporter.attr("id"));submitbutton("importfrom")})});form.find("button.export").bind("click",function(){var format=form.find('input[name="format"]');format.val("raw");form.find('input[name="exporter"]').val("zoo2");submitbutton($(this).data("task"));format.val("html")})}});$.fn[Plugin.prototype.name]=function(){var args=arguments;var method=args[0]?args[0]:null;return this.each(function(){var element=$(this);if(Plugin.prototype[method]&&element.data(Plugin.prototype.name)&&method!="initialize"){element.data(Plugin.prototype.name)[method].apply(element.data(Plugin.prototype.name),Array.prototype.slice.call(args,1))}else if(!method||$.isPlainObject(method)){var plugin=new Plugin;if(Plugin.prototype["initialize"]){plugin.initialize.apply(plugin,$.merge([element],args))}element.data(Plugin.prototype.name,plugin)}else{$.error("Method "+method+" does not exist on jQuery."+Plugin.name)}})}})(jQuery);(function($){var Plugin=function(){};Plugin.prototype=$.extend(Plugin.prototype,{name:"Import",options:{msgSelectWarning:"You didn't assign all item types. Items of these types will not be imported. Do you want to proceed anyway?",msgWarningDuplicate:"There are duplicate assignments.",msgNameWarning:"Please choose a name column.",task:"doimport"},initialize:function(form,options){this.options=$.extend({},this.options,options);var $this=this;this.form=form;form.find("fieldset.frontpage, fieldset.categories").each(function(){var fieldset=$(this);fieldset.find('input[name^="import-"]').bind("change",function(){if($(this).is(":checked")){fieldset.find("div.assign-group").show()}else{fieldset.find("div.assign-group").hide()}})});form.find("fieldset.items").each(function(){var fieldset=$(this);fieldset.find("select.type").bind("change",function(){var type=$(this);var regexp=new RegExp("\\["+type.val()+"\\]$");fieldset.find("li.assign select.assign").each(function(){var select=$(this);if(select.attr("name").match(regexp)){var name=select.nextAll(".name").text().trim();select.show().find("option").each(function(){if($(this).text().replace(/\(.*\)/i,"").trim()==name){select.val($(this).val())}})}else{select.hide()}})})});$("#submit-button").bind("click",function(){if($this.options.task!="doimportcsv"&&$this.hasDuplicateSelectedAssignments()){alert($this.options.msgWarningDuplicate)}else if($this.options.task=="doimportcsv"&&!$this.hasNameAssigned()){alert($this.options.msgNameWarning)}else if($this.hasUnassignedTypes()&&!confirm($this.options.msgSelectWarning)){}else{submitbutton($this.options.task)}})},hasNameAssigned:function(){var result=false;this.form.find("div.assign-group").each(function(){var regexp=new RegExp("\\["+$(this).find("select.type").val()+"\\]$");$(this).find("select.assign").each(function(){if($(this).attr("name").match(regexp)&&$(this).val()=="_name"){result=true;return}})});return result},hasUnassignedTypes:function(){var result=false;this.form.find("select.type").each(function(){if($(this).val()==""){result=true;return}});return result},hasDuplicateSelectedAssignments:function(){var result=false;this.form.find("div.assign-group").each(function(){var selects=$(this).find("select.assign");for(i=0;i<selects.length;i++){for(j=i+1;j<selects.length;j++){value_a=$(selects.get(i)).val();value_b=$(selects.get(j)).val();if(value_a!=""&&value_a!="_category"&&value_a==value_b){result=true;return}}}});return result}});$.fn[Plugin.prototype.name]=function(){var args=arguments;var method=args[0]?args[0]:null;return this.each(function(){var element=$(this);if(Plugin.prototype[method]&&element.data(Plugin.prototype.name)&&method!="initialize"){element.data(Plugin.prototype.name)[method].apply(element.data(Plugin.prototype.name),Array.prototype.slice.call(args,1))}else if(!method||$.isPlainObject(method)){var plugin=new Plugin;if(Plugin.prototype["initialize"]){plugin.initialize.apply(plugin,$.merge([element],args))}element.data(Plugin.prototype.name,plugin)}else{$.error("Method "+method+" does not exist on jQuery."+Plugin.name)}})}})(jQuery);