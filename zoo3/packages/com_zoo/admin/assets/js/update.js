/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

(function(e){var t=function(){};t.prototype=e.extend(t.prototype,{name:"Update",options:{msgPerformingUpdate:"Performing Update...",msgFinished:"Update successfull...Reload page to continue working.",msgError:"Error during update. Please visit the YOOtheme support forums."},initialize:function(t,s){this.options=e.extend({},this.options,s);var a=this;this.form=t;t.find("button.update").bind("click",function(){e(this).parent().remove();a.step()})},step:function(){var t=this.form;var s=this;e.ajax({url:t.attr("action"),type:"post",datatype:"json",data:t.serialize(),beforeSend:function(){s.addMessage(s.options.msgPerformingUpdate,"loading")},success:function(a){try{a=e.parseJSON(a)}catch(i){a={error:true,message:a}}t.find("div.message-box").find("div.message").last().removeClass("loading");if(a.error){s.addMessage(a.message,"error")}else{s.addMessage(a.message);if(a["continue"]){s.step()}else{s.addMessage(s.options.msgFinished,"success")}}},error:function(e,a){t.find("div.message-box").find("div.message").last().removeClass("loading");s.addMessage(a,"error")}})},addMessage:function(t,s){var t=e('<div class="message">').text(t).appendTo(this.form.find("div.message-box"));if(s)t.addClass(s)}});e.fn[t.prototype.name]=function(){var s=arguments;var a=s[0]?s[0]:null;return this.each(function(){var i=e(this);if(t.prototype[a]&&i.data(t.prototype.name)&&a!="initialize"){i.data(t.prototype.name)[a].apply(i.data(t.prototype.name),Array.prototype.slice.call(s,1))}else if(!a||e.isPlainObject(a)){var o=new t;if(t.prototype["initialize"]){o.initialize.apply(o,e.merge([i],s))}i.data(t.prototype.name,o)}else{e.error("Method "+a+" does not exist on jQuery."+t.name)}})}})(jQuery);