/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

(function(e){var d=function(){};d.prototype=e.extend(d.prototype,{name:"Update",options:{msgPerformingUpdate:"Performing Update...",msgFinished:"Update successfull...Reload page to continue working.",msgError:"Error during update. Please visit the YOOtheme support forums."},initialize:function(c,a){this.options=e.extend({},this.options,a);var b=this;this.form=c;c.find("button.update").bind("click",function(){e(this).parent().remove();b.step()})},step:function(){var c=this.form,a=this;e.ajax({url:c.attr("action"),
type:"post",datatype:"json",data:c.serialize(),beforeSend:function(){a.addMessage(a.options.msgPerformingUpdate,"loading")},success:function(b){try{b=e.parseJSON(b)}catch(d){b={error:true,message:b}}c.find("div.message-box").find("div.message").last().removeClass("loading");b.error?a.addMessage(b.message,"error"):(a.addMessage(b.message),b["continue"]?a.step():a.addMessage(a.options.msgFinished,"success"))},error:function(b,d){c.find("div.message-box").find("div.message").last().removeClass("loading");
a.addMessage(d,"error")}})},addMessage:function(c,a){c=e('<div class="message">').text(c).appendTo(this.form.find("div.message-box"));a&&c.addClass(a)}});e.fn[d.prototype.name]=function(){var c=arguments,a=c[0]?c[0]:null;return this.each(function(){var b=e(this);if(d.prototype[a]&&b.data(d.prototype.name)&&a!="initialize")b.data(d.prototype.name)[a].apply(b.data(d.prototype.name),Array.prototype.slice.call(c,1));else if(!a||e.isPlainObject(a)){var f=new d;d.prototype.initialize&&f.initialize.apply(f,
e.merge([b],c));b.data(d.prototype.name,f)}else e.error("Method "+a+" does not exist on jQuery."+d.name)})}})(jQuery);
